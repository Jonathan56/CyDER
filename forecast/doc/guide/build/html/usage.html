<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. Usage of the Forecasting Module &#8212; PV Forecasting Module</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Help" href="help.html" />
    <link rel="prev" title="3. Build" href="build.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="help.html" title="7. Help"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="build.html" title="3. Build"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PV Forecasting Module</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Usage of the Forecasting Module</a></li>
<li><a class="reference internal" href="#setting-the-environment-optional">5. Setting the Environment [Optional]</a></li>
<li><a class="reference internal" href="#training-a-neural-network">6. Training a Neural Network</a><ul>
<li><a class="reference internal" href="#running-predictions">6.1. Running Predictions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="build.html"
                        title="previous chapter">3. Build</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="help.html"
                        title="next chapter">7. Help</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/usage.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="usage-of-the-forecasting-module">
<span id="usage"></span><h1>4. Usage of the Forecasting Module<a class="headerlink" href="#usage-of-the-forecasting-module" title="Permalink to this headline">¶</a></h1>
<p>Before embarking on this section please make sure you&#8217;ve followed the instructions
at <a class="reference internal" href="build.html"><span class="doc">Build</span></a>.</p>
<p>At a high level, the forecasting module allows the user to do two things:</p>
<ol class="arabic simple">
<li>Train a neural network model</li>
<li>Run predictions on unseen data using the model trained</li>
</ol>
<p>In this section, we will go over the options available to the user for each of these modes.
In general, many of the operations allowed by the module require a data file, please see
<a class="reference internal" href="help.html"><span class="doc">Help</span></a> for information about the data file format.</p>
<p>A summary of these options can be found by executing the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./forecast-main --help
</pre></div>
</div>
<div class="highlight-rest"><div class="highlight"><pre><span></span>Usage: Forecast [OPTIONS]...

  -h, --help                    Print help and exit
  -V, --version                 Print version and exit

Training:
  Train the neural network with a given dataset.
      --training-file=Data File File to get training data from.
      --validation-file=Validation Data File
                                File to use as validations set.
      --test-file=Test Data File
                                File to use as training set.
      --num-tapped-delay-lines=INT
                                Number of tapped delay lines to use for both
                                  input and output  (default=`1&#39;)
      --initial-weight-range=FLOAT
                                Range to randomize initial weights on. It will
                                  randomize from [-value,value].
                                  (default=`0.1&#39;)
      --initial-learning-rate=FLOAT
                                Initial value for the learning rate.
                                  (default=`0.01&#39;)
      --initial-momentum=FLOAT  Initial value for the learning momentum.
                                  (default=`0.01&#39;)
      --hidden-layers=INT       Size of each hidden layer separated by commas
      --max-epochs=INT          Number of epochs to use while training.
                                  (default=`10&#39;)
      --error-function=STRING   Function to use when calculating error.
                                  Currently only MSE and RMSE are available
                                  (default=`MSE&#39;)
      --desired-error=FLOAT     Desired error to achieve during training.
                                  (default=`0.01&#39;)
      --learning-rate-adaptation=STRING
                                Desired learning rate adaptation technique.
                                  Currently available: LINEAR, CURRENT.
                                  (default=`LINEAR&#39;)
      --random-search=INT       Whether we should train the network using
                                  random hyperparameter search or not.
                                  (default=`0&#39;)

Prediction:
  Use the a neural network specified by a .net file to predict a time series.
  If a test file is provided, we will run evaluations.
      --narx-file=narx.net file File to load narx specific parameters from.
      --fann-file=.net file     File to load neural network from, this should
                                  be generated by FANN.
      --predict-file=Predict File
                                File to used to feed inputs into for
                                  prediction.
</pre></div>
</div>
</div>
<div class="section" id="setting-the-environment-optional">
<h1>5. Setting the Environment [Optional]<a class="headerlink" href="#setting-the-environment-optional" title="Permalink to this headline">¶</a></h1>
<p>In order to log output to a file we need to set a few environment variables, this is
because our module needs to know where the files should be saved to and where the log
configurations are saved. To set these variables automatically execute the following commands:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Make sure you&#39;re at root</span>
<span class="nb">cd</span> forecast/
<span class="nb">source</span> bin/setenv.sh
</pre></div>
</div>
<p>The setenv.sh script is a simple helper script that sets all the environment variables to
their default values. The log outputs will be saved inside the forecast/log folder by default.</p>
<p>Below is a table of the customizable environment variables:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Environment Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>FORECAST_LOG_CONFIGURATION</td>
<td>Points to the ZLOG configuration file</td>
</tr>
<tr class="row-odd"><td>FORECAST_LOG_FILE</td>
<td>Points to the file where the log output will be saved</td>
</tr>
<tr class="row-even"><td>FORECAST_LOG_LEVEL</td>
<td>Specifies the verbosity of our logs</td>
</tr>
</tbody>
</table>
<p>The FORECAST_LOG_LEVEL can take the following values:</p>
<ul class="simple">
<li>DEBUG</li>
<li>INFO</li>
<li>NOTICE</li>
<li>WARN</li>
<li>ERROR</li>
<li>FATAL</li>
<li>NONE</li>
</ul>
</div>
<div class="section" id="training-a-neural-network">
<h1>6. Training a Neural Network<a class="headerlink" href="#training-a-neural-network" title="Permalink to this headline">¶</a></h1>
<p>To train a neural network we minimally need a training data file.
A network can be trained right off the box using the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./forecast_main --training-file<span class="o">=</span>&lt;FILE&gt;
</pre></div>
</div>
<p>This command will train a neural network with default parameters, this tends to yield
poor results in general. Training a good neural network requires the tuning of many
hyper-parameters to achieve good convergence. The table below lists every hyper-parameter
and the corresponding command-line option that the user can use.</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="37%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Hyper-Parameter</th>
<th class="head">Command Line Option</th>
<th class="head">Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Initial Learning Rate</td>
<td>&#8211;initial-learning-rate</td>
<td>Float</td>
</tr>
<tr class="row-odd"><td>Tapped Delay Lines</td>
<td>&#8211;num-tapped-delay-lines</td>
<td>Int</td>
</tr>
<tr class="row-even"><td>Momentum</td>
<td>&#8211;initial-momentum</td>
<td>Float</td>
</tr>
<tr class="row-odd"><td>Hidden Layers</td>
<td>&#8211;hidden-layers</td>
<td>Comma Separated Int</td>
</tr>
<tr class="row-even"><td>Number of Epochs</td>
<td>&#8211;max-epochs</td>
<td>Int</td>
</tr>
<tr class="row-odd"><td>Error Function</td>
<td>&#8211;error-functions</td>
<td>&#8220;RMSE&#8221; or &#8220;MSE&#8221;</td>
</tr>
<tr class="row-even"><td>Desired Error</td>
<td>&#8211;desired-error</td>
<td>Float</td>
</tr>
<tr class="row-odd"><td>Learning Rate Adaptation</td>
<td>&#8211;learning-rate-adaptation</td>
<td>&#8220;LINEAR&#8221; or &#8220;BOLD&#8221;</td>
</tr>
</tbody>
</table>
<p>Another good option to use is &#8211;test-file. This option allows you to pass test data
on which to evaluate your model. Now we know how to modify hyper-parameters and we can
pass a training and testing data file. As an example, suppose we want to train a neural
network with two hidden layers of size 10, momentum 0.9, learning rate of 0.01 and 3
tapped delay lines. To do so, we would run the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./forecast-main --training-file<span class="o">=</span>TRAIN_FILE --test-file<span class="o">=</span>TEST_FILE
                --hidden-layers<span class="o">=</span><span class="m">10</span>,10 --initial-momentum<span class="o">=</span><span class="m">0</span>.9 --initial-learning-rate<span class="o">=</span><span class="m">0</span>.01
                --num-tapped-delay-lines<span class="o">=</span><span class="m">3</span>
</pre></div>
</div>
<p>The output to this command is two serialized neural network files called fann.net and narx.net.
When running predictions we will load our models from these files so make sure to keep them
around.</p>
<div class="section" id="running-predictions">
<h2>6.1. Running Predictions<a class="headerlink" href="#running-predictions" title="Permalink to this headline">¶</a></h2>
<p>Running predictions is very similar to training a neural network, there are two inputs
needed: the serialized neural network and a prediction data file. Please look
at <a class="reference internal" href="help.html"><span class="doc">Help</span></a> to see the prediction file format as it differs slightly from the training and
testing data format.</p>
<p>Given these inputs, run the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./forecast-main --narx-file<span class="o">=</span>NARXNET --fann-file<span class="o">=</span>FANNNET --predict-file<span class="o">=</span>PREDICT_FILE
</pre></div>
</div>
<p>The output of the command is a CSV file with the prediction for each timestep. Nothing else
is required in order to run predictions.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="help.html" title="7. Help"
             >next</a> |</li>
        <li class="right" >
          <a href="build.html" title="3. Build"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PV Forecasting Module</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015-2018, The Regents of the University of California (through Lawrence Berkeley National Laboratory).
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.5.
    </div>
  </body>
</html>