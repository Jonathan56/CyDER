
#--------------------------------- Rules --------------------------------------

ifeq ($(MODELREF_TARGET_TYPE),NONE)
  # Top model for RTW               
$(PROGRAM) : clean_program $(OBJS) $(RTWLIB) MODELREF_LINK_LIBS_MAIN
	@echo "### Linking ..."
	$(PERL) $(GEN_LNK_SCRIPT) $(CMD_FILE) $(OBJS)
	$(LD) $(LDFLAGS) $(RTWLIB) $(MODELREF_LINK_LIBS) @$(CMD_FILE) $(LIBS) -out:$@
	@del $(CMD_FILE)
	@echo "### Created executable $@"
   
else
  # Top model for RTW               
$(PROGRAM) : clean_program $(OBJS) $(RTWLIB) MODELREF_LINK_LIBS_MAIN
	@echo "### Creating library ..."
	lib /nologo /OUT:$(RELATIVE_PATH_TO_ANCHOR)/OpNTtarget/$(MODELLIB) $(OBJS)   
	@echo "### Created library $@"
        
endif                 

MAKE = gmake
   
%.obj : %.c
	$(CC) $(CFLAGS) $<

%.obj : ../%.c
	$(CC) $(CFLAGS) $<

%.obj : %.cpp
	$(CC) $(CFLAGS) $<

%.obj : $(TARGET_RTLAB_ROOT)/Simulink/rtw/c/common/%.c
	$(CC) $(CFLAGS) $<

%.obj : $(TARGET_RTLAB_ROOT)/RT-LAB/lib/%.c
	$(CC) $(CFLAGS) $<

%.obj : $(ALT_MATLAB_ROOT)/rtw/c/src/matrixmath/%.c
	$(CC) $(CFLAGS) $<

%.obj : $(ALT_MATLAB_ROOT)/rtw/c/src/%.c
	$(CC) $(CFLAGS) $<

%.obj : $(ALT_MATLAB_ROOT)/rtw/c/libsrc/%.c
	$(CC) $(CFLAGS) $<

%.obj : $(ALT_MATLAB_ROOT)/toolbox/comm/commsfun/%.c
	$(CC) $(CFLAGS) $<

%.obj : $(ALT_MATLAB_ROOT)/toolbox/dspblks/dspmex/%.c
	$(CC) $(CFLAGS) $<

%.obj : $(ALT_MATLAB_ROOT)/toolbox/fixpoint/%.c
	$(CC) $(CFLAGS) $<

%.obj : $(ALT_MATLAB_ROOT)/toolbox/fuzzy/fuzzy/src/%.c
	$(CC) $(CFLAGS) $<
	
%.obj : $(RELATIVE_PATH_TO_ANCHOR)/%.c
	$(CC) -c $(CFLAGS) $<
	
%.obj : $(SHARED_SRC_DIR)/%.c
	$(CC) -c $(CFLAGS) $<	


#----------------------------- Dependencies -----------------------------------

$(OBJS) : $(MAKEFILE) rtw_proj.tmw

clean_program:
	@if exist $PROGRAM del $PROGRAM